(()=>{"use strict";var e,t=function(e,t,n,o){var r,c,i,a=e.cloneNode(!0),l=a.querySelector(".card__like-button"),u=a.querySelector(".card__like-count"),s=a.querySelector(".card__delete-button"),d=a.querySelector(".card__image"),p=t.owner._id;return d.src=t.link,d.alt=t.name,u.textContent=t.likes.length,a.querySelector(".card__title").textContent=t.name,d.addEventListener("click",(function(e){n.popUpHandler(d)})),l.addEventListener("click",(function(e){n.likeHandler(l,u,o,t,n.webApi)})),p===o.ownerId?s.addEventListener("click",(function(e){n.deleteButtonHandler(a,o,t,n.webApi)})):s.classList.add("popup__button_hidden"),r=t.likes,c=o.ownerId,i=l,r.forEach((function(e){e._id===c&&i.classList.add("card__like-button_is-active")})),a},n=function(e,t,n){var o=e.querySelector("."+t.id+n.errorMark);t.classList.remove(n.errorSelector),o.textContent=""},o=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.buttonDisabledClass),t.removeAttribute("disabled")):(t.classList.add(n.buttonDisabledClass),t.setAttribute("disabled",!0))},r=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(o){n(e,o,t)}));var o=e.querySelector(t.buttonSelector);o.classList.contains(t.buttonDisabledClass)||o.classList.add(t.buttonDisabledClass)},c=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),e.addEventListener("click",l)},i=function(e){e.classList.contains("popup_is-opened")&&e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a),e.removeEventListener("click",l)},a=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");i(t)}},l=function(e){i(e.target)},u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-33",headers:{authorization:"b3ccccd1-a8c7-4152-a066-4b44c9241c5a","Content-Type":"application/json"}},s=function(e,t,n){return fetch(u.baseUrl+e,{method:t,headers:u.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},d=document.querySelector("#card-template").content.querySelector(".places__item"),p=document.querySelector(".places").querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__edit__avatar_button"),m=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_edit-avatar"),y=document.querySelector(".popup_type_new-card"),k=document.forms["edit-profile"],S=k.name,h=k.description,L=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),q=document.querySelector(".profile__edit__avatar_button"),g=document.querySelector(".popup_type_image"),E=g.querySelector(".popup__image"),x=g.querySelector(".popup__caption"),A=document.forms["new-place"],w=A.link,P=A["place-name"],D=(A.querySelector(".popup__button"),document.forms["change-avatar"]),T=D.link,H={linkProfile:"/users/me",linkCards:"/cards",linkCardLikes:"/cards/likes/",linkProfileAvatar:"/users/me/avatar"},U={errorSelector:"popup__input_error",inputSelector:".popup__input",buttonSelector:".popup__button",buttonDisabledClass:"popup__button_disabled",formSelector:".popup__form",errorMark:"-error"},M={deleteButtonHandler:function(e,t,n,o){o(t.linkCards+"/"+n._id,"DELETE").then((function(t){e.remove()})).catch((function(e){console.log(e)}))},popUpHandler:function(e){E.src=e.src,E.alt=e.alt,x.textContent=e.alt,c(g)},likeHandler:function(e,t,n,o,r){var c=n.linkCardLikes+o._id;e.classList.contains("card__like-button_is-active")?r(c,"DELETE").then((function(n){t.textContent=n.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)})):r(c,"PUT").then((function(n){t.textContent=n.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)}))},webApi:s};document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(function(){i(e)}))})),m.addEventListener("click",(function(){""===P.value&&""===w.value||A.reset(),r(A,U),c(y)})),A.addEventListener("submit",(function(e){if(e.preventDefault(),e.submitter.textContent="Сохранение...",""!==P.value&&""!==w.value){var n={name:P.value,link:w.value};s(H.linkCards,"POST",n).then((function(e){p.prepend(t(d,e,M,H)),i(y),A.reset()})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))}})),f.addEventListener("click",(function(){S.value=L.textContent,h.value=C.textContent,r(k,U),c(v)})),k.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...";var t={name:S.value,about:h.value};s(H.linkProfile,"PATCH",t).then((function(e){L.textContent=e.name,C.textContent=e.about,i(v)})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),_.addEventListener("click",(function(){console.log("open ava-edit"),D.reset(),r(D,U),c(b)})),b.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...";var t={avatar:T.value};s(H.linkProfileAvatar,"PATCH",t).then((function(e){q.style.cssText="background-image: url("+e.avatar+")",i(b),D.reset()})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),e=U,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.buttonSelector);o(r,c,t),r.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?n(e,t,o):function(e,t,n,o){var r=e.querySelector("."+t.id+n.errorMark);t.classList.add(n.errorSelector),r.textContent=o}(e,t,o,t.dataset.errorMessage)}(e,i,t),o(r,c,t)}))}))}(t,e)}));var j=[s(H.linkProfile).then((function(e){var t;return t=e,L.textContent=t.name,C.textContent=t.about,q.style.cssText="background-image: url("+t.avatar+")",new Promise((function(t,n){t(e._id)}))})).catch((function(e){console.log("Ошибка при загрузке профиля",e)})),s(H.linkCards).catch((function(e){console.log("Ошибка при загрузке карточек пользователей",e)}))];Promise.all(j).then((function(e){H.ownerId=e[0],e[1].forEach((function(e){p.append(t(d,e,M,H))}))})).catch((function(e){console.log("Произошла ошибка: ",e)}))})();